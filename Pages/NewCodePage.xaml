<Page x:Class="HeisenParserWPF.Pages.NewCodePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      mc:Ignorable="d"
      d:DesignHeight="720" d:DesignWidth="1280"
      Background="#22222A"
      Unloaded="Page_Unloaded"
      Title="NewCodePage">

    <Page.Resources>
        <Color x:Key="AccentColor">#00BFFF</Color>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource AccentColor}"/>

        <Style x:Key="BackButtonSpecialStyle" TargetType="Button">
            <Setter Property="Margin" Value="0,6"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Background" Value="#FF9900"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFB347"/>
                    <Setter Property="Foreground" Value="Black"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SidebarButton" TargetType="Button">
            <Setter Property="Margin" Value="0,6"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Background" Value="#33333C"/>
            <Setter Property="Foreground" Value="#EEEEEE"/>
            <Setter Property="BorderBrush" Value="#4A4A55"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A4A55"/>
                    <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button" BasedOn="{StaticResource SidebarButton}">
            <Setter Property="Padding" Value="15,7"/>
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="Black"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Opacity="0.5" Direction="315" ShadowDepth="2" BlurRadius="4"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#33CCFF"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="{StaticResource AccentColor}" Opacity="0.8" Direction="0" ShadowDepth="0" BlurRadius="8"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ZoomButtonStyle" TargetType="Button" BasedOn="{StaticResource SidebarButton}">
            <Setter Property="Background" Value="#3C3C45"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="2"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#555560"/>
                    <Setter Property="Foreground" Value="{StaticResource AccentBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="TabItemStyle" TargetType="TabItem">
            <Setter Property="Background" Value="#2D2D35"/>
            <Setter Property="Foreground" Value="#AAAAAA"/>
            <Setter Property="BorderBrush" Value="#44444D"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" BorderThickness="1,1,1,0" BorderBrush="{TemplateBinding BorderBrush}" CornerRadius="5,5,0,0" Margin="2,0" Padding="10,5">
                            <ContentPresenter x:Name="ContentSite" VerticalAlignment="Center" HorizontalAlignment="Center" ContentSource="Header"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#22222A" />
                                <Setter Property="Foreground" Value="{StaticResource AccentBrush}" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource AccentBrush}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter TargetName="Border" Property="Background" Value="#2D2D35" />
                                <Setter TargetName="Border" Property="BorderBrush" Value="#44444D" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#3C3C45" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="#2C2C34" BorderBrush="#3E3E40" BorderThickness="0,0,1,0" Padding="12">
            <StackPanel Orientation="Vertical" Width="130">

                <Button Content="Back" Style="{StaticResource BackButtonSpecialStyle}" Click="Back_Click" Margin="0,0,0,15"/>

                <TextBlock Text="Code Elements" Foreground="#888890" Margin="0,5,0,5" FontSize="10" FontWeight="Bold"/>
                <Button Content="Assign" Tag="type:assign" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="Console.W" Tag="type:console.write" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="Return" Tag="type:return" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>

                <Border Height="1" Background="#4A4A55" Margin="0,10,0,10"/>
                <Button Content="If" Tag="type:if" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="For" Tag="type:for" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="While" Tag="type:while" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="Do/While" Tag="type:do/while" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="Try/Catch" Tag="type:try/catch" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>

                <Border Height="1" Background="#4A4A55" Margin="0,10,0,10"/>
                <Button Content="Function" Tag="type:function" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="Class" Tag="type:class" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
                <Button Content="Custom Node" Tag="type:custom" PreviewMouseLeftButtonDown="Snippet_PreviewMouseLeftButtonDown" Style="{StaticResource SidebarButton}"/>
            </StackPanel>
        </Border>

        <Grid Grid.Column="1" Margin="25,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="5*"/>
                <RowDefinition Height="3*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" x:Name="FilePathTextBlock" Foreground="#CCCCCC" FontSize="20" FontWeight="Bold" Text="New Code File" Margin="0,20,0,15"/>

            <Border Grid.Row="1" BorderBrush="#4A4A55" BorderThickness="1" CornerRadius="10" Background="#2A2A33" Margin="0,0,0,15" ClipToBounds="True">
                <Grid>
                    <WindowsFormsHost x:Name="GraphHost" ToolTip="DRAG &amp; PAN: Left-click a node to drag it. Middle-click the background to pan the view."/>

                    <StackPanel Orientation="Horizontal" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="15">
                        <Button Content="+" Click="ZoomIn_Click" Width="35" Height="35" Style="{StaticResource ZoomButtonStyle}" ToolTip="Zoom In"/>
                        <Button Content="-" Click="ZoomOut_Click" Width="35" Height="35" Margin="5,0" Style="{StaticResource ZoomButtonStyle}" ToolTip="Zoom Out"/>
                        <Button Content="Fit" Click="ResetZoom_Click" Width="45" Height="35" Style="{StaticResource ZoomButtonStyle}" ToolTip="Fit Graph to View"/>
                    </StackPanel>
                </Grid>
            </Border>

            <TabControl Grid.Row="2" Background="#2C2C34" BorderBrush="#4A4A55" BorderThickness="0,1,0,0">
                <TabItem Header="Code Editor" Style="{StaticResource TabItemStyle}">
                    <Grid>
                        <TextBox x:Name="CodeEditor"
								AcceptsReturn="True" AcceptsTab="True" TextWrapping="NoWrap"
								VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
								Background="#2C2C34" Foreground="#DCDCDC" FontFamily="Consolas"
								FontSize="14" BorderThickness="0" Padding="15,10"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="10">
                            <Button Content="Redraw Graph" Click="RedrawGraph_Click" ToolTip="Re-parse the code and update the visual graph and JSON file.">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
                                        <Setter Property="Background" Value="#555555"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#777777"/>
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#555555" Opacity="0.8" Direction="0" ShadowDepth="0" BlurRadius="8"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>

                            <Button Content="Generate with AI" Click="GenerateCodeWithAI_Click" ToolTip="Generate C# code from the current saved graph structure (ast.json).">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
                                        <Setter Property="Background" Value="#20A090"/>
                                        <Setter Property="Foreground" Value="Black"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#30C0B0"/>
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#20A090" Opacity="0.8" Direction="0" ShadowDepth="0" BlurRadius="8"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="AI Generated Code" Style="{StaticResource TabItemStyle}">
                    <TextBox x:Name="AiGeneratedCodeBox" IsReadOnly="True" AcceptsReturn="True" AcceptsTab="True" TextWrapping="NoWrap"
							VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Background="#2C2C34" Foreground="#90EE90"
							FontFamily="Consolas" FontSize="14" BorderThickness="0" Padding="15,10"/>
                </TabItem>

                <TabItem Header="AI Assistant" Style="{StaticResource TabItemStyle}">
                    <Grid Background="#2C2C34">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBox x:Name="AiResponseBox" Grid.Row="0" IsReadOnly="True" Background="#22222A" Foreground="#ADFFAD"
								FontFamily="Consolas" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Padding="10" BorderThickness="0"/>

                        <Grid Grid.Row="1" Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" CornerRadius="5" Margin="0,0,5,0" Background="#3C3C45">
                                <TextBox x:Name="AiInputBox" Background="Transparent" Foreground="White" BorderThickness="0" Padding="5"/>
                            </Border>
                            <Button Content="Send" Grid.Column="1" Click="SendMessage_Click" Style="{StaticResource ActionButtonStyle}" Margin="0" Padding="10,7" FontWeight="SemiBold"/>
                        </Grid>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Page>